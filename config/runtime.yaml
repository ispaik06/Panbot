# Panbot/config/runtime.yaml

paths:
  corners: "Panbot/vision/calibration/corners.json"
  yolo_model: "Panbot/vision/models/runs/batter_seg_local_v1/weights/best.pt"
  gru_ckpt: "Panbot/vision/models/runs/resnet18_gru16_cls/best.pt"

log:
  dir: "Panbot/logs"
  level: "INFO"

robot:
  type: "so101_follower"
  port: "/dev/ttyACM0"
  id: "my_awesome_follower_arm"
  calibration_dir: ""  # 필요 시 경로, 아니면 빈 문자열

  # ⚠️ policy(LeRobot)에서 쓸 카메라들 (vision cam과 별도)
  cameras:
    right:
      type: "opencv"
      index_or_path: 2
      width: 640
      height: 480
      fps: 30
      fourcc: "MJPG"
    left:
      type: "opencv"
      index_or_path: 6
      width: 640
      height: 480
      fps: 30
      fourcc: "MJPG"
    global:
      type: "opencv"
      index_or_path: 4
      width: 640
      height: 480
      fps: 30
      fourcc: "MJPG"
    wrist:
      type: "opencv"
      index_or_path: 10
      width: 640
      height: 480
      fps: 30
      fourcc: "MJPG"

vision:
  # ✅ YOLO/GRU가 공유해서 쓰는 "단일" 비전 카메라
  cam_index: 0
  backend: "v4l2"
  mjpg: true

  width: 3840
  height: 2160
  fps: 30

  # UI
  show: true
  yolo_preview_scale: 0.55
  gru_preview_scale: 0.30

  # watchdog
  watchdog_s: 2.0

yolo_trigger:
  conf: 0.25
  imgsz: 640
  area_thr_ratio: 0.17
  hold_frames: 30
  use_warp: true
  warp_w: 0   # 0이면 corners 기반 자동
  warp_h: 0

gru_trigger:
  image_size: 224
  seq_len: 16
  stride: 6
  ema: 0.7
  ready_hold: 3
  amp: true
  use_warp: true
  warp_w: 0   # 0이면 corners 기반 자동
  warp_h: 0

task:
  # main loop (권장: task.hz == policy_fps == vision.fps 로 맞추기)
  hz: 30

  # Task1 motion stepper
  task1_ramp_time_s: 3.0
  task1_pose_hold_s: 1.0

  # Base pose 유지
  base_pose_hold_interval_s: 0.25

  # Policy
  policy_fps: 30
  task2_duration_s: 10.0
  task3_duration_s: 10.0
  wait_task2_to_task3_s: 30.0

poses:
  base_pose:
    shoulder_pan.pos: -9.298892988929879
    shoulder_lift.pos: -98.8125530110263
    elbow_flex.pos: 99.90880072959416
    wrist_flex.pos: 50.977060322854726
    wrist_roll.pos: 4.299947561615085
    gripper.pos: 0.2722940776038121

  task1_initial_sequence:
    - { shoulder_pan.pos: -51.119, shoulder_lift.pos: -5.567, elbow_flex.pos: 75.829, wrist_flex.pos: -43.922, wrist_roll.pos: 57.608, gripper.pos: 80.903 }
    - { shoulder_pan.pos: -59.631, shoulder_lift.pos: 24.182, elbow_flex.pos: 42.935, wrist_flex.pos: -44.007, wrist_roll.pos: 54.302, gripper.pos: 25.834 }
    - { shoulder_pan.pos: -42.782, shoulder_lift.pos: -33.787, elbow_flex.pos: 14.13, wrist_flex.pos: 35.536, wrist_roll.pos: 54.092, gripper.pos: 25.834 }
    - { shoulder_pan.pos: -20.842, shoulder_lift.pos: -3.612, elbow_flex.pos: 14.675, wrist_flex.pos: 21.05, wrist_roll.pos: 23.924, gripper.pos: 25.703 }
    - { shoulder_pan.pos: -20.14, shoulder_lift.pos: 26.902, elbow_flex.pos: -23.944, wrist_flex.pos: 36.298, wrist_roll.pos: -21.091, gripper.pos: 25.768 }

  task1_return_sequence:
    - { shoulder_pan.pos: -20.14, shoulder_lift.pos: 26.902, elbow_flex.pos: -23.944, wrist_flex.pos: 36.298, wrist_roll.pos: -21.091, gripper.pos: 25.768 }
    - { shoulder_pan.pos: -20.842, shoulder_lift.pos: -3.612, elbow_flex.pos: 14.675, wrist_flex.pos: 21.05, wrist_roll.pos: 23.924, gripper.pos: 25.703 }
    - { shoulder_pan.pos: -42.782, shoulder_lift.pos: -33.787, elbow_flex.pos: 14.13, wrist_flex.pos: 35.536, wrist_roll.pos: 54.092, gripper.pos: 25.834 }
    - { shoulder_pan.pos: -59.631, shoulder_lift.pos: 24.182, elbow_flex.pos: 42.935, wrist_flex.pos: -44.007, wrist_roll.pos: 54.302, gripper.pos: 25.834 }
    - { shoulder_pan.pos: -51.119, shoulder_lift.pos: -5.567, elbow_flex.pos: 75.829, wrist_flex.pos: -43.922, wrist_roll.pos: 57.608, gripper.pos: 80.903 }

policies:
  policy1:
    repo_id: "ispaik06/act_panbot_task2_3"
    task: null
    rename_map: {}
    dataset_repo_id: null
    dataset_root: null
    use_amp: true
    print_joints: false
    print_joints_every: 30

  policy2:
    repo_id: "ispaik06/act_panbot_task3_3"
    task: null
    rename_map: {}
    dataset_repo_id: null
    dataset_root: null
    use_amp: true
    print_joints: false
    print_joints_every: 30
